# 📊 蠟燭圖表顏色說明

## ✅ 正確理解

### 蠟燭顏色 = 價格變化方向

在所有專業交易平台（包括 Pump.fun）中，蠟燭顏色表示的是**價格變化**，而不是**交易類型**：

#### 🟢 綠色蠟燭（上漲）
- **定義**: Close Price > Open Price
- **意思**: 在這個時間段內，價格上漲了
- **可能的交易**: 買入 OR 賣出（都可能）

#### 🔴 紅色蠟燭（下跌）
- **定義**: Close Price < Open Price  
- **意思**: 在這個時間段內，價格下跌了
- **可能的交易**: 買入 OR 賣出（都可能）

---

## 🎯 實際案例

### 案例 1: 連續買入，但價格下跌
```
買入 #1: 價格 0.0123 → 產生紅色蠟燭（如果之前價格更高）
買入 #2: 價格 0.0116 → 產生紅色蠟燭（價格從 0.0123 下降）
買入 #3: 價格 0.0126 → 產生綠色蠟燭（價格從 0.0116 上升）
```

這是**完全正常**的行為！

### 案例 2: Pump.fun 的真實情況
看你提供的 Pump.fun 截圖：
- 圖表有綠色和紅色蠟燭混合
- 這些蠟燭反映的是**價格波動**
- 與買入/賣出操作**無直接關係**

---

## 💡 為什麼會這樣？

### 價格計算邏輯
我們的系統使用**自動做市商(AMM)公式**：
```javascript
newPrice = basePrice * (1 + priceImpact)
priceImpact = (amount / totalSupply) * impactFactor

// 買入時
impactFactor = ±5% 隨機波動

// 賣出時  
impactFactor = -2% 固定下跌
```

### 為什麼買入時價格會下跌？
1. **市場深度不足** - 小幣種供應量大，單筆交易影響小
2. **隨機波動** - 模擬真實市場的價格波動（±5%）
3. **競爭賣壓** - 其他用戶可能在賣出

這與真實 Pump.fun 的行為**完全一致**！

---

## 🔍 如何驗證是否正確？

### 方法 1: 檢查數據庫
```bash
# 查看最近 5 筆交易
SELECT type, amount, price, timestamp 
FROM transactions 
WHERE coin_id = 1 
ORDER BY timestamp DESC 
LIMIT 5;
```

應該看到：
- `type` 欄位正確（'buy' 或 'sell'）
- `price` 有高有低（正常波動）

### 方法 2: 檢查圖表數據
```javascript
// 在控制台執行
console.log('Chart data:', chart.candlestickSeries.data());
```

應該看到：
- 每根蠟燭有 `open`, `high`, `low`, `close`
- 顏色由 `close` vs `open` 決定

---

## ❓ 如果你遇到的是其他問題

### 問題 A: 交易記錄顯示錯誤
**症狀**: 買入時，交易記錄顯示「賣出」
**原因**: 數據庫 `type` 欄位錯誤
**需要修復**: Yes ✅

### 問題 B: 蠟燭顏色與價格趨勢不符
**症狀**: 價格上漲但顯示紅色蠟燭
**原因**: OHLC 計算錯誤
**需要修復**: Yes ✅

### 問題 C: 買入時出現紅色蠟燭
**症狀**: 連續買入，但有些蠟燭是紅色的
**原因**: 價格在那個時段下跌了（正常行為）
**需要修復**: No ❌ 這是正確的

---

## 📝 請確認

請告訴我你遇到的是哪種情況：

1. **交易記錄顯示錯誤**？
   - 例如：買入時，Recent Transactions 顯示「Sell」

2. **蠟燭顏色與實際價格不符**？
   - 例如：價格從 0.01 → 0.02，但顯示紅色蠟燭

3. **只是蠟燭有紅有綠**？
   - 這是正常的，反映價格波動

請提供：
- 具體的錯誤截圖
- 交易記錄（Recent Transactions）的截圖  
- 圖表顯示的問題截圖

這樣我才能準確定位問題！
